<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>StepDub</title>
  </head>
  <body>
    <header>
    <svg class="chart" id="accelgraph" preserveAspectRatio="none" viewBox=""></svg>
    <h1 id="appname"><img src="headline.svg" alt="StepDub"></h1>
    </header>
    <h2 id="active-label" class="banner">Ninja Clan Foot Stealth</h1>
    <div id="buttons"></div>
    <footer>
    <svg width="100%" height="100px" viewBox="0 0 640 100" xmlns="http://www.w3.org/2000/svg">
     <defs>
      <linearGradient y2="1" x2="1" y1="0" x1="1" id="svg_9">
       <stop stop-opacity="0.18" stop-color="#ffffff" offset="0"/>
       <stop stop-opacity="0.06" stop-color="#ffffff" offset="1"/>
      </linearGradient>
     </defs>
     <g>
      <title>Layer 1</title>
      <g transform="rotate(-179.51800537109375 310.7359924316406,39.5625) " id="layer1">
       <rect id="rect5537" width="49.618557" height="74.8283" x="-2.957134" y="-86.835409" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6424" width="49.618557" height="74.8283" x="46.328114" y="-86.835073" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
       <rect id="rect6426" width="49.618557" height="74.8283" x="95.94364" y="-86.835073" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6428" width="49.618557" height="74.8283" x="145.43525" y="-86.835104" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
       <rect id="rect6430" width="49.618557" height="74.8283" x="195.05584" y="-86.830312" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6432" width="49.618557" height="74.8283" x="244.51993" y="-86.806112" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
       <rect id="rect6434" width="49.618557" height="74.8283" x="294.17661" y="-86.799604" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6436" width="49.618557" height="74.8283" x="343.46186" y="-86.799268" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
       <rect id="rect6438" width="49.618557" height="74.8283" x="393.07737" y="-86.799268" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6440" width="49.618557" height="74.8283" x="442.56897" y="-86.799299" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
       <rect id="rect6442" width="49.618557" height="74.8283" x="492.18958" y="-86.794508" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6444" width="49.618557" height="74.8283" x="541.65369" y="-86.770307" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
       <rect id="rect6446" width="49.618557" height="74.8283" x="591.35309" y="-86.799597" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="black"/>
       <rect id="rect6448" width="49.618557" height="74.8283" x="640.63837" y="-86.799261" transform="matrix(1.13171,0,0.653939,-0.84286,-45.8683,-2.06544) " stroke-miterlimit="4" stroke-width="0.3" fill-rule="evenodd" fill="yellow"/>
      </g>
      <text fill="#ff0000" transform="scale(1.5 1)" stroke-width="0" stroke-dasharray="null" stroke-linejoin="null" stroke-linecap="null" x="213.3333333333" y="57.979167" id="svg_13" font-size="64" font-family="Racing Sans One, fantasy" text-anchor="middle" xml:space="preserve">PRERELEASE</text>
      <rect id="svg_2" height="72.999991" width="848.99994" y="2.000003" x="-108.999998" stroke-width="5" fill="url(#svg_9)"/>
     </g>
    </svg>
    <a href="about.html">About</a>
    </footer>
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" src="scripts/prep.js"></script>
    <script type="text/javascript" src="scripts/functions.js"></script>
    <script type="text/javascript" src="scripts/charting.js"></script>
    <script>

      /*global stepMachine playSound chartable*/

      "use strict";
      var mal = magAvgListener();
      var chartp = chartable(document.getElementById("accelgraph"),
        {frameSec: 0, defStyle: 'stroke:gray'});

      function chartSilence(mag,grav) {
        chartp(mag,"stroke: gray");
      }

      mal.setCb(function(mag,grav){chartp(mag-grav,"stroke: gray");});

      var stateColors = [ "green", "white", "yellow" ];
      var styleInto = 'stroke:'+stateColors[0];
      function chartState (mag, state){
        chartp(mag,styleInto);
        styleInto = 'stroke:'+stateColors[state];
      }

      function soundTrigger(soundFilename) {
        return function(mag, state){
          if(state==1) playSound(soundFilename);};
      }

      function doubleSounder(upSound,downSound) {
        return function(mag, state){
          if(state==1) playSound(upSound);
          else if(state==2) playSound(downSound);};
      }

      var sensitivity = 4;

      function intenSound(sounds) {
        var max = 0;
        return {
          poll: function(mag, state){
            if (state==1) max = Math.max(max,mag);
          },
          trigger: function(mag, state){
            if (state==2) {
              var i = sounds.length;
              while (max < sensitivity * i) i--;
              playSound(sounds[i]);
              max = 0;
            }
            //TODO: chart the intensity of the step for
            //the duration of state 1
            chartState(mag,state);
          }
        }
      }

      var activeShoe;
      function addShoe(image,label,trigger,poll){
        var button = document.createElement("img");
        var machine = stepMachine(3,trigger,poll);
        button.src = image;
        button.className = "shoe-button";
        button.addEventListener("click",function(evt){
          document.getElementById("active-label").textContent = label;
          activeShoe.classList.remove('active');
          activeShoe = button;
          activeShoe.classList.add('active');
          mal.setCb(machine);
        });
        document.getElementById("buttons").appendChild(button);
        return button;
      }

      activeShoe = addShoe("shoes/ninja.svg","Ninja Clan Foot Stealth",
        null,chartSilence);
      activeShoe.classList.add("active");
      addShoe("shoes/spring.svg","Spring In Your Step",
        soundTrigger('sounds/boing.mp3'),chartState);
      addShoe("shoes/gargantuan.svg","Big Boom",
        soundTrigger('sounds/boom.mp3'),chartState);;
      addShoe("shoes/wetsock.svg","Squish Socks",
        soundTrigger('sounds/splat.mp3'),chartState);
      addShoe("shoes/steamplatform.svg","Steam Pumped Up Kicks",
        doubleSounder('sounds/shocks.mp3','sounds/steam.mp3'),chartState);
      var squeaker = intenSound([
        'sounds/squeaks/ball.mp3',
        'sounds/squeaks/rat.mp3',
        'sounds/squeaks/horn.mp3']);
      addShoe("shoes/squeaky.svg","Squeaky Shoes",
        squeaker.trigger,squeaker.poll);
    </script>
  </body>
</html>
